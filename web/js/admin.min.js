/* KhayCake by TheB1ackSheep, Front-End Developer 2015-05-09 */
$(document).ready(function(){var a=$(".app-loading-mask");var b="http://jsp.falook.me/khaycake";var c=$(".app-content .action-bar");var d=$(".app-content .content");var e=$(".app-content .message");var f={},g=null;var h;Ajax.onError=function(a){var b="";if(!a.responseText&&a.error){if(a.error.length>0){for(var c in a.error.message)f+=a.error.message[c]+"<br/>"}else{b+=a.message}}else{b+="request return with status "+a.status+" : "+a.statusText}alert(b);i.loadedMask()};var i=i||{xhr:[],isAjax:false,loadingMask:function(){a.html("<span class='loader'><span class='loader-inner'></span></span>");a.addClass("show")},loadedMask:function(){a.html("");a.removeClass("show")},toMoney:function(a){return a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}};i.onHashChanged=function(){var a=urlParse();var b=a.resources[1];var c=a.resources[2];var d=a.resources[3];switch(b){case"cakes":i.tabCake();break;case"customers":i.tabCustomer();break;case"bankaccount":i.tabBank();break;case"order":i.tabOrder();break;case"payment":i.tabPayment();break;case"shipment":i.tabShipment();break;default:b="dashboard";i.tabDashboard();break}$(".app-nav a").removeClass("active");$(".app-nav a#"+b).addClass("active")};i.tabDashboard=function(){i.loadingMask();var a='<form id="form-search-dashboard"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-dashboard" type="submit">ค้นหา</button></span></div></form>';var b=urlParse();var e=b.resources[2];var f=b.resources[3];var g=b.params.query;var h=getParameter("spage");var j=getParameter("ppage");Order.shipping(function(b){Payment.approving(function(e){if(!b.message)b.message={};if(!e.message)e.message={};if(g)a='<div class="el"><a class="btn btn-default" href="#!/dashboard">กลับ</a></div><form id="form-search-dashboard"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-dashboard" type="submit">ค้นหา</button></span></div></form>';$(c).html(a);if(g)$("#form-search-dashboard").find("#keyword").val(g);else $("#form-search-dashboard").find("#keyword").val("");var f=pagination(b.message,h,5,"spage");var k=pagination(e.message,j,5,"ppage");var l=i.tabDashboard.shippingOrder.table(f.data);if(f.hasNext)l+=f.html;l+=i.tabDashboard.approvingPayment.table(k.data);if(k.hasNext)l+=k.html;$(d).html(l);i.tabDashboard.bind();i.loadedMask()},g)},g)};i.tabDashboard.bind=function(){$("#form-search-dashboard").submit(function(){window.location.hash=urlParam("query",$(this).find("#keyword").val());return false})};i.tabDashboard.shippingOrder=function(){};i.tabDashboard.shippingOrder.table=function(a){var b='<h2>รายการสั่งซื้อที่ต้องจัดส่ง</h2><table class="p6n-table">';b+="<tr>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">เลขที่สั่งซื้อ</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">วันที่สั่ง</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">จำนวน (ชิ้น)</a>'+"</th>"+'<th class="p6n-acl-header-name text-right">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">ราคาทั้งหมด (บาท)</a>'+"</th>"+"</tr>";if(a.length>0){for(var c in a){var d=a[c];b+='<tr><td><a href="#!/shipment/'+d.id+'">#'+d.id+"</a></td><td>"+d.date+"</td><td>"+d.totalQty+'</td><td class="text-right">'+toMoney(d.totalPrice)+"</td></tr>"}}else{b+='<tr><td colspan="4">ไม่มีรายการสั่งซื้อที่ต้องจัดส่ง</td> </tr>'}b+="</table>";return b};i.tabDashboard.approvingPayment=function(){};i.tabDashboard.approvingPayment.table=function(a){var b='<h2>รายการแจ้งชำระเงินที่รอการยืนยัน</h2><table class="p6n-table">';b+="<tr>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">เลขที่สั่งซื้อ</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">วันที่แจ้ง</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">โอนเข้าบัญชี</a>'+"</th>"+'<th class="p6n-acl-header-name text-right">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">ยอดที่แจ้ง (บาท)</a>'+"</th>"+'<th class="p6n-acl-header-name text-right">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">ยอดที่ต้องชำระ (บาท)</a>'+"</th>"+"</tr>";if(a.length>0){for(var c in a){var d=a[c];b+='<tr><td><a href="#!/payment/'+d.id+'">#'+d.order.id+'</a></td><td><span style="font-size:12px">'+d.dateTime+"</div></td>"+"<td>"+d.baac.accNo+" "+d.baac.branch.bank.name+"</td>"+'<td class="text-right">'+toMoney(d.amount)+"</td>"+'<td class="text-right">'+toMoney(d.order.totalPrice)+"</td></tr>"}}else{b+='<tr><td colspan="5">ไม่มีรายการแจ้งชำระที่ต้องยืนยัน</td> </tr>'}b+="</table>";return b};i.tabOrder=function(){i.loadingMask();var a='<form id="form-search-order"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-order" type="submit">ค้นหา</button></span></div></form>';var b=urlParse();var e=b.resources[2];var f=b.resources[3];var g=b.params.query;var h=getParameter("page");if(isInteger(e)){Order.find(e,function(a){Order.items(e,function(b){if(!a.message)a.message={};if(!b.message)b.message={};$(c).html("");var e=pagination(a.message,h,10);var f=i.tabOrder.form(e.data,b.message);if(e.hasNext)f+='<div class="page">'+e.html+"</div>";$(d).html(f);i.loadedMask()})})}else{Order.all(function(b){if(!b.message)b.message={};if(g)a='<div class="el"><a class="btn btn-default" href="#!/order">กลับ</a></div><form id="form-search-order"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-order" type="submit">ค้นหา</button></span></div></form>';$(c).html(a);if(g)$("#form-search-order").find("#keyword").val(g);else $("#form-search-order").find("#keyword").val("");var e=pagination(b.message,h,10);var f=i.tabOrder.table(e.data);if(e.hasNext)f+=e.html;$(d).html(f);i.tabOrder.bind();i.loadedMask()},g)}};i.tabOrder.bind=function(){$("#form-search-order").submit(function(){window.location.hash=urlParam("query",+$(this).find("#keyword").val());return false})};i.tabOrder.table=function(a){var b='<table class="table">';b+='<tr><th>เลขที่</th><th>วันที่สั่งซื้อ</th><th>จำนวน (ชิ้น)</th><th>สถานะ</th><th class="text-right">ราคาทั้งหมด (บาท)</th></tr>';if(a.length>0){for(var c in a){var d=a[c];var e="";if(d.status.id==1||d.status.id==2||d.status.id==5)e="rgb(226, 163, 0)";else if(d.status.id==3)e="green";else e="red";b+='<tr><td><a href="#!/order/'+d.id+'">#'+d.id+"</a></td><td>"+d.date+"</td>"+"<td>"+d.totalQty+'</td><td><span style="color:'+e+'">'+d.status.name+'</span></td><td  class="text-right">'+toMoney(d.totalPrice)+"</td></tr>"}}else{b+='<tr><td colspan="5">ไม่มีรายการสั่งซื้อ</td></tr>'}b+="</table>";return b};i.tabOrder.form=function(a,b){var c=a.shipAddress;var d="";if(c){d+='<form class="order" id="form-order" style="width:500px">'+"<h2>รายการสั่งซื้อ #"+a.id+"</h2><h3>ที่อยู่ในการจัดส่ง</h3>"+"<p>คุณ"+c.firstName+" "+c.lastName+"<br/>"+c.address+"<br/>"+c.tumbon.name+", "+c.tumbon.amphur.name+"<br/>"+c.tumbon.amphur.province.name+" "+c.tumbon.zipcode+"</p>"}var e="";if(a.status.id==1||a.status.id==2||a.status.id==5)e="rgb(226, 163, 0)";else if(a.status.id==3)e="green";else e="red";d+="<h3>สถานะ</h3>";d+='<p><span style="color:'+e+'">'+a.status.name+" "+(a.status.id==3?"เลขติดตาม "+a.trackId:"")+"</span></p>";d+="<h3>รายการสินค้า</h3>";d+='<table class="table"><tr><th>ชื่อ</th><th>จำนวน</th><th class="text-right">ราคา (บาท)</th></tr>';if(b.length>0){var f=b;var g=0;for(var h in f){var i=f[h];d+="<tr><td>"+i.product.name+"</td>"+"<td>"+i.qty+" "+i.product.unit.name+"</td>"+'<td class="text-right">'+toMoney(i.amount)+"</td></tr>";g+=i.amount}if(a.shipMethod){d+="<tr><td>ค่าจัดส่ง ("+a.shipMethod.name+")</td>"+"<td></td>"+'<td class="text-right">'+toMoney(a.shipMethod.price)+"</td></tr>";g+=a.shipMethod.price}d+='<tr><td colspan="2" class="text-right">รวม</td><td class="text-right" id="order-total">'+toMoney(g)+"</td></tr>"}else{d+='<tr><td colspan="3">ไม่มีสินค้าในตะกร้า</td></tr>'}d+="</table>";d+="</form>";return d};i.tabPayment=function(){i.loadingMask();var a='<form id="form-search-payment"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-payment" type="submit">ค้นหา</button></span></div></form>';var b=urlParse();var e=b.resources[2];var f=b.resources[3];var g=b.params.query;var h=getParameter("page");if(isInteger(e)){$(c).html("");if(!f){Payment.find(e,function(a){if(!a.message)a.message={};i.tabPayment.form(a.message)})}else{if(f=="accept"){Payment.accept(e,function(a){if(a.message){alert("เปลี่ยนสถานะการแจ้งชำระเรียบร้อย");window.location.hash="#!/payment"}})}else if(f=="deny"){Payment.deny(e,function(a){if(a.message){alert("เปลี่ยนสถานะการแจ้งชำระเรียบร้อย");window.location.hash="#!/payment"}})}else{window.location.hash="#!/payment/"+e}}}else{Payment.all(function(b){if(!b.message)b.message={};if(g)a='<div class="el"><a class="btn btn-default" href="#!/payment">กลับ</a></div><form id="form-search-payment"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-payment" type="submit">ค้นหา</button></span></div></form>';$(c).html(a);if(g)$("#form-search-payment").find("#keyword").val(g);else $("#form-search-payment").find("#keyword").val("");var e=pagination(b.message,h,10);var f=i.tabPayment.table(e.data);if(e.hasNext)f+=e.html;$(d).html(f);i.tabPayment.bind();i.loadedMask()},g)}};i.tabPayment.bind=function(){$("#form-search-payment").submit(function(){window.location.hash=urlParam("query",+$(this).find("#keyword").val());return false})};i.tabPayment.table=function(a){var b='<table class="table">';b+='<tr><th>เลขที่สั่งซื้อ</th><th>วันที่แจ้ง</th><th>โอนเข้าบัญชี</th><th>สถานะ</th><th class="text-right">ยอดที่แจ้ง (บาท)</th></tr>';if(a.length>0){for(var c in a){var d=a[c];var e="";if(d.status.id==1)e="rgb(226, 163, 0)";else if(d.status.id==2)e="green";else e="red";b+='<tr><td><a href="#!/payment/'+d.id+'">#'+d.order.id+'</a></td><td><span style="font-size:12px">'+d.dateTime+"</span></td>"+"<td>"+d.baac.accNo+" "+d.baac.branch.bank.name+"</td>"+'<td><span style="color:'+e+'">'+d.status.name+'</span></td><td class="text-right">'+toMoney(d.amount)+"</td></tr>"}}else{b+='<tr><td colspan="5">ไม่มีรายการแจ้งชำระเงิน</td></tr>'}b+="</table>";return b};i.tabPayment.form=function(a){var b=a.order;var c='<div class="payment"><div class="col-sm-6"><h2>รายการแจ้งชำระเลขที่ '+a.id+"</h2>";c+="<h3>วันที่แจ้งชำระ</h3>";c+="<p>"+a.dateTime+"</p>";c+="<h3>ช่องทางในการชำระ</h3>";c+="<p>เลขบัญชี : "+a.baac.accNo+"<br/>ชื่อบัญชี : "+a.baac.accName+"<br/>"+a.baac.branch.bank.name+""+" สาขา"+a.baac.branch.name+"</p>";c+='<h2 class="title">ยอดที่แจ้ง</h2>';c+="<p>"+toMoney(a.amount)+" บาท</p>";var e="";if(a.status.id==1)e="rgb(226, 163, 0)";else if(a.status.id==2)e="green";else e="red";c+='<h2 class="title">สถานะ</h2>';c+='<p><span style="color:'+e+'">'+a.status.name+"</span></p>";if(a.status.id==1)c+='<div class="btn-group"><a href="#!/payment/'+a.id+'/accept" class="btn btn-success">ยืนยันรายการนี้</a><a href="#!/payment/'+a.id+'/deny" class="btn btn-danger">ปฎิเสธรายการนี้</a></div>';c+="</div>";var f=b.shipAddress;c+='<div class="col-sm-6"><form class="order" id="form-order" style="width:500px">'+"<h2>รายการสั่งซื้อ #"+b.id+"</h2><h3>ที่อยู่ในการจัดส่ง</h3>"+"<p>คุณ"+f.firstName+" "+f.lastName+"<br/>"+f.address+"<br/>"+f.tumbon.name+", "+f.tumbon.amphur.name+"<br/>"+f.tumbon.amphur.province.name+" "+f.tumbon.zipcode+"</p>";c+="<h3>รายการสินค้า</h3>";c+='<table class="table"><tr><th>ชื่อ</th><th>จำนวน</th><th class="text-right">ราคา (บาท)</th></tr>';Order.items(b.id,function(a){if(a.message&&a.message.length>0){var e=0;for(var f in a.message){var g=a.message[f];c+="<tr><td>"+g.product.name+"</td>"+"<td>"+g.qty+" "+g.product.unit.name+"</td>"+'<td class="text-right">'+toMoney(g.amount)+"</td></tr>";e+=g.amount}if(b.shipMethod){c+="<tr><td>ค่าจัดส่ง ("+b.shipMethod.name+")</td>"+"<td></td>"+'<td class="text-right">'+toMoney(b.shipMethod.price)+"</td></tr>";e+=b.shipMethod.price}c+='<tr><td colspan="2" class="text-right">รวม</td><td class="text-right" id="order-total">'+toMoney(e)+"</td></tr>"}else{c+='<tr><td colspan="3">ไม่มีสินค้า</td></tr>'}c+="</table>";c+="</form></div></div>";$(d).html(c);i.tabPayment.bind();i.loadedMask()})};i.tabShipment=function(){i.loadingMask();var a='<form id="form-search-shipment"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-shipment" type="submit">ค้นหา</button></span></div></form>';var b=urlParse();var e=b.resources[2];var f=b.resources[3];var g=b.params.query;var h=getParameter("page");if(isInteger(e)){$(c).html("");if(!f){Order.find(e,function(a){Order.items(e,function(b){if(!a.message)a.message={};if(!b.message)b.message={};$(c).html("");var e=i.tabShipment.form(a.message,b.message);$(d).html(e);i.tabShipment.bind();i.loadedMask()})})}}else{Order.shipping(function(b){if(!b.message)b.message={};if(g)a='<div class="el"><a class="btn btn-default" href="#!/shipment">กลับ</a></div><form id="form-search-shipment"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาโดยเบอร์โทรศัพท์, อีเมล์, ชื่อ-นามสกุล" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-shipment" type="submit">ค้นหา</button></span></div></form>';$(c).html(a);if(g)$("#form-search-shipment").find("#keyword").val(g);else $("#form-search-shipment").find("#keyword").val("");var e=pagination(b.message,h,10);var f=i.tabShipment.table(e.data);if(e.hasNext)f+=e.html;$(d).html(f);i.tabShipment.bind();i.loadedMask()},g)}};i.tabShipment.bind=function(){$("#form-search-shipment").submit(function(){window.location.hash=urlParam("query",+$(this).find("#keyword").val());return false});$("#form-shipped").submit(function(){i.loadingMask();var a=$(this).find("#order_id").val();var b=$(this).find("#track_id").val();Order.shipped(a,b,function(a){if(a.message){alert("เปลี่ยนสถานะเป็นจัดส่งเรียบร้อย");window.location.hash="#!/shipment"}});return false})};i.tabShipment.table=function(a){var b='<table class="p6n-table">';b+="<tr>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">เลขที่สั่งซื้อ</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">วันที่สั่ง</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">จำนวน (ชิ้น)</a>'+"</th>"+'<th class="p6n-acl-header-name text-right">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">ราคาทั้งหมด (บาท)</a>'+"</th>"+"</tr>";if(a.length>0){for(var c in a){var d=a[c];b+='<tr><td><a href="#!/shipment/'+d.id+'">#'+d.id+"</a></td><td>"+d.date+"</td><td>"+d.totalQty+'</td><td class="text-right">'+toMoney(d.totalPrice)+"</td></tr>"}}else{b+='<tr><td colspan="4">ไม่มีรายการสั่งซื้อที่ต้องจัดส่ง</td> </tr>'}b+="</table>";return b};i.tabShipment.form=function(a,b){var c=a.shipAddress;var d='<div class="shipment"><div class="col-sm-6">';if(c){d+='<form class="order" id="form-order" style="width:500px">'+"<h2>รายการสั่งซื้อ #"+a.id+"</h2><h3>ที่อยู่ในการจัดส่ง</h3>"+"<p>คุณ"+c.firstName+" "+c.lastName+"<br/>"+c.address+"<br/>"+c.tumbon.name+", "+c.tumbon.amphur.name+"<br/>"+c.tumbon.amphur.province.name+" "+c.tumbon.zipcode+"</p></form>"}var e="";if(a.status.id==1||a.status.id==2||a.status.id==5)e="rgb(226, 163, 0)";else if(a.status.id==3)e="green";else e="red";d+="<h3>สถานะ</h3>";d+='<p><span style="color:'+e+'">'+a.status.name+"</span></p>";if(a.status.id==2){d+='<form id="form-shipped">'+'<input type="hidden" name="order_id" id="order_id" value="'+a.id+'"/>'+'<div class="input-group">'+'<input type="text" name="track_id" id="track_id" class="form-control" placeholder="เลขติดตามพัสดุ">'+'<span class="input-group-btn">'+'<button class="btn btn-success" id="do-shipped" type="submit">เปลี่ยนสถานะเป็นจัดส่งสินค้าเรียบร้อย</button></span></div></form>'}d+="</div>";d+='<div class="col-sm-6"><h3>รายการสินค้า</h3>';d+='<table class="table"><tr><th>ชื่อ</th><th>จำนวน</th><th class="text-right">ราคา (บาท)</th></tr>';if(b.length>0){var f=b;var g=0;for(var h in f){var i=f[h];d+="<tr><td>"+i.product.name+"</td>"+"<td>"+i.qty+" "+i.product.unit.name+"</td>"+'<td class="text-right">'+toMoney(i.amount)+"</td></tr>";g+=i.amount}if(a.shipMethod){d+="<tr><td>ค่าจัดส่ง ("+a.shipMethod.name+")</td>"+"<td></td>"+'<td class="text-right">'+toMoney(a.shipMethod.price)+"</td></tr>";g+=a.shipMethod.price}d+='<tr><td colspan="2" class="text-right">รวม</td><td class="text-right" id="order-total">'+toMoney(g)+"</td></tr>"}else{d+='<tr><td colspan="3">ไม่มีสินค้าในตะกร้า</td></tr>'}d+="</table>";d+="</div></div>";return d};i.tabCake=function(){var a='<div class="el"><button class="btn btn-default" id="refresh-cake">รีเฟรช</button></div><div class="el btn-group"><a href="#!/cakes/create" class="btn btn-primary" id="add-cake">เพิ่มเค้ก</a><button class="btn btn-danger disabled" id="delete-cake">ลบ</button></div><div class="el"><form id="form-search-cake"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาตามชื่อเค้ก, คำอธิบาย" required><span class="input-group-btn"><button class="btn btn-default" id="search-cake" type="submit">ค้นหา</button></span></div></form></div>';var b=urlParse();var e=b.resources[2],f=b.resources[3],g=b.params.query,h=getParameter("page");if(g)a='<div class="el"><a href="#!/cakes" class="btn btn-default">กลับ</a></div><div class="el"><form id="form-search-cake"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาตามชื่อเค้ก, คำอธิบาย" required><span class="input-group-btn"><button class="btn btn-default" id="search-cake" type="submit">ค้นหา</button></span></div></form></div>';i.loadingMask();if(!e){Product.all(function(b){$(c).html(a);if(g)$("#form-search-cake").find("#keyword").val(g);else $("#form-search-cake").find("#keyword").val("");var e=pagination(b.message,h,10);var f=i.tabCake.table(e.data);if(e.hasNext)f+=e.html;$(d).html(f);i.tabCake.bind();i.loadedMask()},g)}else if(e){if(isInteger(e)){Product.find(e,function(b){var f=b.message;a='<div class="el"><a href="#!/cakes" class="btn btn-default">กลับ</a></div><div class="el"><button class="btn btn-primary" id="update-cake">บันทึก</button></div>';$(c).html(a);$(d).html(Product.form("แก้ไขเค้กใหม่",f));Unit.box(function(a){$("#unit-container").html(a);$("#unit-container select").val(f.unit.id);Category.box(function(a){$("#category-container").html(a);$("#category-container select").val(f.category.id);Product.pictures(e,function(a){var b="";for(var c in a.message){var d=a.message[c];b+=Product.form.picture(d)}$("#form-cake #pic-list").html(b);Product.sales(e,function(a){var b="";for(var c in a.message){var d=a.message[c];b+=Product.form.sale(d)}$("#form-cake #product_sale").html(b);i.tabCake.bind(e)})})})})})}else{if(e==="create"){a='<div class="el"><a href="#!/cakes" class="btn btn-default">กลับ</a></div><div class="el"><button class="btn btn-primary" id="save-cake">บันทึก</button></div>';$(c).html(a);$(d).html(Product.form("เพิ่มเค้กใหม่"));Unit.box(function(a){$("#unit-container").html(a);Category.box(function(a){$("#category-container").html(a);i.tabCake.bind()})})}}}};i.tabCake.table=function(a){var b='<div id="error"></div><div id="message"></div><form id="form-cake"><table class="p6n-table">'+"<tbody>"+"<tr>"+'<th style="width:13px">'+'<label class="ng-isolate-scope p6n-checkbox">'+'<input type="checkbox" class="ng-valid ng-scope ng-dirty ng-valid-parse ng-touched">'+"</label>"+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">ชื่อเค้ก</a>'+"</th>"+'<th class="p6n-acl-header-name" >'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link p6n-sort-flip">ชนิด</a>'+"</th>"+'<th class="p6n-acl-header-name text-right">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link p6n-sort-flip">ต้นทุน (บาท)</a>'+"</th>"+'<th class="p6n-acl-header-name text-right">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link p6n-sort-flip">ขาย (บาท)</a>'+"</th>"+"</tr>";if(a&&a.length>0){for(var c in a){var d=a[c];b+="<tr>"+"<td>"+'<label class="ng-isolate-scope p6n-checkbox">'+'<input type="checkbox"  name="p_id" value="'+d.id+'" class="ng-valid ng-scope ng-dirty ng-valid-parse ng-touched">'+"</label>"+"</td>"+'<td><a href="#!/cakes/'+d.id+'">'+d.name+"</a></td>"+"<td>"+d.category.name+"</td>"+'<td class="text-right">'+i.toMoney(d.cost)+"</td>"+'<td class="text-right">'+i.toMoney(d.price)+"</td>"+"</tr>"}}else{b+='<tr><td colspan="5">ไม่มีเค้กใด ๆ ในระบบ</td></tr>'}b+="</table>";return b};i.tabCake.bind=function(a){i.loadedMask();$("input[type=checkbox]").on("change",function(a){var b=$("#form-cake").serializeArray();if(b&&b.length>0)$("#delete-cake").removeClass("disabled");else $("#delete-cake").addClass("disabled")});$("#refresh-cake").click(function(){i.onHashChanged()});$("#form-search-cake").submit(function(a){window.location.hash=urlParam("query",$(this).find("#keyword").val());return false});$("#form-cake #add-sale").click(function(a){var b=$("#product_sale");var c=$("#product_sale>div").length;if(c<5){$(b).append(Product.form.sale());$("#product_sale>div a").click(function(){$(this).parent().parent().parent().remove()})}return false});$("#product_sale>div a").click(function(){$(this).parent().parent().parent().remove()});$(".action-bar #save-cake").click(function(a){i.loadingMask();Product.save($("#form-cake"),function(a){i.loadedMask();alert("เพิ่มข้อมูลเรียบร้อย");window.location.hash="#!/cakes"})});$(".action-bar #update-cake").click(function(b){i.loadingMask();Product.update(a,$("#form-cake"),function(a){i.loadedMask();alert("แก้ไขข้อมูลเรียบร้อย");window.location.hash="#!/cakes"})});$(".action-bar #delete-cake").click(function(){var a=$("#form-cake").serializeArray();if(a&&a.length>0){i.loadingMask();var b=a.length;var c=0;for(var d in a){Product.delete(a[d].value,function(){i.loadedMask();if(++c==b){alert("ลบข้อมูลเรียบร้อย");i.onHashChanged()}})}}});$("#form-cake #pictures").on("change",function(a){$("#form-cake #pic-list").html("<p>กำลังอัพโหลดไฟล์...</p>");var b=a.target.files;var c=new FormData;$.each(b,function(a,b){c.append("pictures",b)});Ajax.UPLOAD("/picture",c,function(a){if(a.message){var b="";for(var c in a.message){var d=a.message[c];b+=Product.form.picture(d)}$("#form-cake #pic-list").html(b)}})})};i.tabBank=function(){var a='<div class="el"><button class="btn btn-default" id="refresh-bank">รีเฟรช</button></div><div class="el btn-group"><a href="#!/bankaccount/create" class="btn btn-primary">เพิ่มบัญชี</a><button class="btn btn-danger disabled" id="delete-cake">ลบ</button></div><div class="el"><form id="form-search-bank"><div class="input-group" style="max-width: 400px"><input type="text" name="q" id="keyword" class="form-control" required><span class="input-group-btn"><button class="btn btn-default" id="search-bank" type="submit">ค้นหา</button></span></div></form></div>';var b=window.location.hash.substr(2);var e=b.split("/");var f,g;if(e){if(e.length>=3)f=e[2];if(e.length>=4)g=e[3]}i.loadingMask();if(!f){BankAccount.all(function(b){$(c).html(a);i.tabBank.table(b.message);i.tabBank.bind()})}else if(f){switch(f){case"create":a='<div class="el"><a class="btn btn-default" href="#!/bankaccount">กลับ</a></div><div class="el btn-group"><button class="btn btn-primary" id="add-bank">เพิ่มบัญชี</button></div>';$(c).html(a);$(d).html(i.tabBank.form("เพิ่มบัญชีใหม่"));BankType.all(function(a){$("#banktype-container").html(i.tabBank.banktype.form(a.message));Bank.all(function(a){$("#bank-container").html(i.tabBank.bank.form(a.message));i.tabBank.bind()})});break}}};i.tabBank.table=function(a){var b='<form id="form-cake"><table class="p6n-table">'+"<tbody>"+"<tr>"+'<th style="width:13px">'+'<label class="ng-isolate-scope p6n-checkbox">'+'<input type="checkbox" class="ng-valid ng-scope ng-dirty ng-valid-parse ng-touched">'+"</label>"+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link">ชื่อบัญชี</a>'+"</th>"+'<th class="p6n-acl-header-name" >'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link p6n-sort-flip">เลขบัญชี</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link p6n-sort-flip">ประเภท</a>'+"</th>"+'<th class="p6n-acl-header-name">'+'<a href="javascript:;" class="p6n-clickable-link p6n-sort-link p6n-sort-flip">ธนาคาร</a>'+"</th>"+"</tr>";if(a&&a.length>0){for(var c in a){var e=a[c];b+="<tr>"+"<td>"+'<label class="ng-isolate-scope p6n-checkbox">'+'<input type="checkbox"  name="p_id" value="'+e.id+'" class="ng-valid ng-scope ng-dirty ng-valid-parse ng-touched">'+"</label>"+"</td>"+'<td><a href="#!/bankaccount/'+e.id+'">'+e.accName+"</a></td>"+"<td>"+e.accNo+"</td>"+"<td>"+e.type.name+"</td>"+"<td>"+e.branch.bank.name+" สาขา"+e.branch.name+"</td>"+"</tr>"}}else{b+='<tr><td colspan="5">ไม่มีบัญชีธนาคารใด ๆ ในระบบ</td></tr>'}b+="</table>";$(d).html(b)};i.tabBank.form=function(a,b){if(!b)b={};return'<div class="small-padding">'+'<form action="POST" id="form-bankaccount">'+'<h2  class="title">'+a+"</h2>"+'<p class="subtitle">บัญชีที่เพิ่ม จะใช้ในการชำระเงินของลูกค้า</p>'+'<div class="row">'+'<div class="col-md-6" style="max-width: 400px">'+'<div class="form-group">'+'<label for="name">ชื่อบัญชี</label><input class="form-control" id="acc_name" name="acc_name" value="'+(b.acc_name?b.acc_name:"")+'" placeholder="นายขายเค้ก อร่อยดี">'+"</div>"+'<div class="form-group">'+'<label>เลขบัญชี</label><p class="subtitle hint">สามารถใส่เครื่องหมาย - ได้</p><input class="form-control" id="acc_no" name="acc_no" value="'+(b.acc_no?b.acc_no:"")+'">'+"</div>"+'<div class="form-group">'+'<label for="pictures">ประเภทบัญชี</label><div id="banktype-container"></div>'+"</div>"+'<div class="form-group">'+'<label for="pictures">ธนาคาร</label><div id="bank-container"></div>'+"</div>"+'<div class="form-group">'+'<label for="pictures">สาขา</label><input class="form-control" id="branch_name"><input type="hidden" id="branch_id" name="branch_id">'+"</div>"+"</form>"+"</div>"};i.tabBank.bank={};i.tabBank.bank.form=function(a){var b='<select class="form-control" id="bank_id">';for(var c in a){var d=a[c];b+='<option value="'+d.id+'">'+d.name+"</option>"}b+="<select>";return b};i.tabBank.banktype={};i.tabBank.banktype.form=function(a){var b='<select class="form-control" id="type_id" name="type_id">';for(var c in a){var d=a[c];b+='<option value="'+d.id+'">'+d.name+"</option>"}b+="<select>";return b};i.tabBank.bind=function(){i.loadedMask();$("#add-bank").click(function(){i.loadingMask();BankAccount.add($("#form-bankaccount"),function(a){i.loadedMask();alert("เพิ่มข้อมูลเรียบร้อย");window.location.hash="#!/bankaccount"});return false});$("#branch_name").autocomplete({serviceUrl:HOST+"/bank/"+$("#bank_id").val()+"/branches",paramName:"q",transformResult:function(a){if(JSON.parse(a).message)return{suggestions:$.map(JSON.parse(a).message,function(a){return{value:a.name,data:a.id}})};return{suggestions:[]}},onSelect:function(a){$("#form-bankaccount").find("#branch_id").val(a.data)}});$("#bank_id").change(function(){$("#branch_name").autocomplete({serviceUrl:HOST+"/bank/"+$("#bank_id").val()+"/branches",paramName:"q",transformResult:function(a){if(JSON.parse(a).message)return{suggestions:$.map(JSON.parse(a).message,function(a){return{value:a.name,data:a.id}})};return{suggestions:[]}},onSelect:function(a){$("#form-bankaccount").find("#branch_id").val(a.data)}})});$("#form-search-bank").submit(function(){return false})};$(window).bind("hashchange",function(){i.onHashChanged()});if(window.location.hash){i.onHashChanged()}});