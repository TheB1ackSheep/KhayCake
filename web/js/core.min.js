/* KhayCake by TheB1ackSheep, Front-End Developer 2015-05-09 */
var HOST="http://jsp.falook.me/khaycake";var sessionID="";function isInteger(a){return a?a.toString().match(/^[0-9]+$/)!==null:false}function isFloat(a){return a?(isInteger(a.toString())||a.toString().match(/^\.[0-9]+$/)||a.toString().match(/^[0-9]+\.[0-9]+$/))!==null:false}function toMoney(a){return a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}function urlParam(a,b){var c=window.location.hash;var d=c.split("?");var e=d[0];var f=d[1];if(f){f=f.split("&");for(var g in f)if(f[g].indexOf(a)>=0)f[g]=a+"="+b;f=f.join("&")}else{f=a+"="+b}return e+"?"+f}function pagination(a,b,c){var d={html:"",hasNext:false,data:a};if(isInteger(b)){b=parseInt(b);var e=window.location.hash.split("/").slice(0,-1).join("/");if(a&&a.slice){var f=(b-1)*c;var g=f+c;d.total=Math.ceil(a.length/c);d.hasNext=d.total!=1&&b<=d.total;if(d.hasNext){d.html="<nav>"+'<ul class="pagination">';if(b!=1)d.html+="<li>"+'<a class="page-prev" href="'+urlParam("page",b-1)+'" aria-label="Previous">'+'<span aria-hidden="true">&laquo;</span>'+"</a>"+"</li>";for(var h=1;h<=d.total;h++){d.html+="<li "+(b==h?'class="active"':"")+'><a href="'+urlParam("page",h)+'" class="page-button">'+h+"</a></li>"}if(b<d.total)d.html+="<li>"+'<a href="'+urlParam("page",b+1)+'" class="page-next" aria-label="Next">'+'<span aria-hidden="true">&raquo;</span>'+"</a>"+"</li>";d.html+="</ul>"+"</nav>"}d.data=a.slice(f,g)}return d}else{return pagination(a,1,c)}}function setPage(a,b){if(typeof a==="object")if(a&&a.page&&isInteger(b))a.page=b;else if(a)a.page=1}function getPage(a){if(typeof a==="object"){if(a.page&&isInteger(a.page)){return a.page}else{setPage(a,1);return getPage(a)}}else{return null}}var Ajax=Ajax||{};Ajax.onError=function(a){};Ajax.encodeUrl=function(a){var b=a.split("?");if(b.length>1){a=b[0]}a=HOST+a+(sessionID?";jsessionid="+sessionID:"")+(b[1]?"?"+b[1]:"");return a};Ajax.do=function(a,b,c,d){var e=$.ajax({type:a,data:c,url:Ajax.encodeUrl(b),success:function(a){if(a.success){if(typeof d==="function")d(a)}else Ajax.onError(a);if(a.sessionId)sessionID=a.sessionId},error:function(a){if(a.sessionId)sessionID=a.sessionId;Ajax.onError(a)}})};Ajax.GET=function(a,b){Ajax.do("GET",a,null,b)};Ajax.POST=function(a,b,c){Ajax.do("POST",a,b,c)};Ajax.UPLOAD=function(a,b,c){var d=$.ajax({type:"POST",url:Ajax.encodeUrl(a),data:b,processData:false,contentType:false,success:function(a){if(a.success){if(typeof c==="function")c(a)}else Ajax.onError(a);if(a.sessionId)sessionID=a.sessionId},error:function(a){if(a.sessionId)sessionID=a.sessionId;Ajax.onError(a)}})};var Product=Product||{URL:"/product"};Product.all=function(a,b){if(!b)Ajax.GET(Product.URL,a);else Ajax.GET(Product.URL+"?q="+b,a)};Product.find=function(a,b){if(a)if(isInteger(a))Ajax.GET(this.URL+"/"+a,b);else Ajax.GET(this.URL+"?q="+a,b)};Product.byCategory=function(a,b,c){if(isInteger(a))Ajax.GET(Product.URL+"?cat="+a+(b?"&q="+b:""),c)};Product.cupcake=function(a,b){Product.byCategory(1,b,a)};Product.crapecake=function(a,b){Product.byCategory(2,b,a)};Product.brownie=function(a,b){Product.byCategory(3,b,a)};Product.partycake=function(a,b){Product.byCategory(4,b,a)};Product.save=function(a,b){if(a&&a.serialize){var c=a.serialize();Ajax.POST(Product.URL,c,b)}};Product.update=function(a,b,c){if(b&&b.serialize){var d=b.serialize();Ajax.POST(Product.URL+"/"+a,d,c)}};Product.delete=function(a,b){Ajax.GET(Product.URL+"/"+a+"/delete",b)};Product.pictures=function(a,b){Ajax.GET(Product.URL+"/"+a+"/pictures",b)};Product.sales=function(a,b){Ajax.GET(Product.URL+"/"+a+"/sales",b)};Product.form=function(a,b){if(!b)b={};return'<div class="small-padding">'+'<form action="POST" id="form-cake">'+"<h2>"+a+"</h2>"+'<div class="row">'+'<div class="col-md-6" style="max-width: 400px">'+'<h3 class="title">ข้อมูลทั่วไป</h3>'+'<p class="subtitle">ข้อมูลทั่วไปเกี่ยวกับเค้ก</p>'+'<div class="form-group">'+'<label for="name">ชื่อเค้ก</label><input class="form-control" id="name" name="name" value="'+(b.name?b.name:"")+'" placeholder="คัพเค้กหน้าเป็ด, เค้กปาร์ตี้วันเกิด">'+"</div>"+'<div class="form-group">'+'<label>รายละเอียด</label><textarea rows="5" class="form-control" name="detail" id="detail">'+(b.detail?b.detail:"")+"</textarea>"+"</div>"+'<div class="form-group">'+'   <label for="pictures">รูปภาพ</label><div id="pic-list"></div><input type="file" accept="image/*" multiple name="pictures" id="pictures"/>'+"</div>"+'<div class="form-group">'+'<div class="row">'+'<div class="col-sm-6">'+'<label>หน่วยนับ</label><div id="unit-container"></div>'+"</div>"+'<div class="col-sm-6">'+"<label>ชนิด</label>"+'<div id="category-container"></div>'+"</div>"+"</div>"+"</div>"+'<div class="form-group">'+'<div class="row">'+'<div class="col-sm-6">'+'<label>ต้นทุน (บาท)</label><div class="input-group"><span class="input-group-addon">&#3647;</span><input type="number"  value="'+(b.cost?b.cost:"")+'" id="cost" name="cost" class="form-control"/></div>'+"</div>"+'<div class="col-sm-6">'+'<label>ราคาขายต่อหน่วย (บาท)</label><div class="input-group"><span class="input-group-addon">&#3647;</span><input type="number"  value="'+(b.price?b.price:"")+'" id="price" name="price" class="form-control"/></div>'+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="col-md-6" style="max-width: 400px">'+'<h3 class="title">ราคาพิเศษ</h3>'+'<p class="subtitle">ราคาขายเมื่อลูกค้าซื้อตามจำนวนที่กำหนด</p>'+'<div class="row" id="product_sale"></div>'+'<div class="form-group">'+'<label>&nbsp;</label><button type="button" class="btn btn-default form-control" id="add-sale">เพิ่มราคาพิเศษ</button>'+"</div>"+"</div>"+"</div>"+"</form>"+"</div>"};Product.form.sale=function(a){if(!a)a={};return'<div class="form-group"><div class="col-md-4">'+'<div class="form-group">'+'<label>จำนวนชิ้น</label><input type="number" name="sale_qty" class="form-control" value="'+(a.qty?a.qty:"")+'"/>'+"</div>"+"</div>"+'<div class="col-md-6">'+'<div class="form-group">'+"<label>ราคาขาย (บาท)</label>"+'<div class="input-group"><span class="input-group-addon">&#3647;</span><input type="number" name="sale_price" class="form-control" value="'+(a.price?a.price:"")+'"/></div>'+'</div></div><div class="col-md-2"><div class="form-group"><label>&nbsp;</label>'+"<a "+(a.id?'id="sale-'+a.id+'"':"")+' class="btn btn-default form-control"><span class="glyphicon glyphicon-trash"></span></a></div></div>'};Product.form.picture=function(a){if(!a)a={};return'<div class="filename alert-dismissible" role="alert">'+(a.filename?a.filename:"")+'</div><input type="hidden" name="pic_id" value="'+(a.id?a.id:"")+'"/>'};Product.box=function(a){if(!a)a={};return'<div class="col-md-3 col-sm-4 col-xs-6">'+'<div class="box inactive">'+'<div class="box-img">'+'<div id="box-img-'+a.id+'" style="background-image:url(\''+HOST+"/product/"+a.id+"/picture')\"></div>"+"</div>"+'<div class="box-name">'+a.name+"</div>"+'<form class="cart-add" action="#!">'+'<input type="hidden" name="p_id" value="'+a.id+'"/>'+'<input type="hidden" name="qty" value="1"/>'+'<div class="box-button">'+'<div class="price">'+a.price+" บาท/"+a.unit.name+"</div>"+'<button class="cart">Add to Cart</button>'+"</div>"+"</form>"+"</div>"+"</div>"};var Unit=Unit||{URL:"/unit"};Unit.all=function(a){Ajax.GET(Unit.URL,a)};Unit.box=function(a){Ajax.GET(Unit.URL,function(b){var c='<select class="form-control" name="unit_id">"';for(var d in b.message){var e=b.message[d];c+='<option value="'+e.id+'">'+e.name+"</option>"}c+="</select>";if(typeof a==="function")a(c)})};var Category=Category||{URL:"/category"};Category.all=function(a){Ajax.GET(Category.url,a)};Category.box=function(a){Ajax.GET(Category.URL,function(b){var c='<select class="form-control" name="cat_id">"';for(var d in b.message){var e=b.message[d];c+='<option value="'+e.id+'">'+e.name+"</option>"}c+="</select>";if(typeof a==="function")a(c)})};var Cart=Cart||{URL:"/cart"};Cart.update=function(a,b){if(a&&a.serialize)Ajax.POST(Cart.URL,a.serialize(),b)};Cart.add=function(a,b){if(a&&a.serialize)Ajax.POST(Cart.URL+"/add",a.serialize(),b)};Cart.all=function(a){Ajax.GET(Cart.URL,a)};Cart.checkout=function(a){Ajax.POST(Cart.URL+"/checkout",null,a)};Cart.form=function(a){var b="";var c=0;if(a.items&&a.items.length>0){var d=a.items;b+='<form id="user-cart"><div class="header row">'+'<div class="cell column-order">YOUR ORDER</div>'+'<div class="cell column-price">PRICE (&#3647;)</div>'+"</div>";for(var e in d){var f=d[e];c+=f.total;b+=Cart.item.form(f,e)}b+='<div class="footer row" style="width:280px;transition-delay:'+(d.length+1)*10+'ms">'+'<div class="cell column-order text-right">รวม</div>'+'<div class="cell column-price">'+toMoney(c)+"</div>"+"</div>";b+='<div class="footer row"  style="width:280px;transition-delay:'+(d.length+2)*10+'ms">'+'<div class="checkout cell text-right">'+'<a class="btn btn-default" href="#!/checkout">Check Out</a>'+"</div>"+"</div>";b+="</form>"}else{b+='<div class="header row">'+'<div class="cell column-order">ไม่มีสินค้าในตะกร้า</div>'+"</div>"}return b};Cart.item={};Cart.item.form=function(a,b){return'<div class="body row" style="transition-delay:'+b*10+'ms">'+'<input type="hidden" name="p_id" value="'+a.product.id+'"/>'+'<input type="hidden" name="qty" value="'+a.qty+'"/>'+'<div title="'+a.product.name+'" class="cell column-order">'+a.product.name+"</div>"+'<div title="'+a.qty+" "+a.product.unit.name+'" class="cell column-qty">'+a.qty+" "+a.product.unit.name+"</div>"+'<div class="cell column-remove">'+'<span class="glyphicon glyphicon-remove"></span>'+"</div>"+'<div class="cell column-price">'+toMoney(a.total)+"</div>"+"</div>"};var Auth=Auth||{URL:"/auth"};Auth.logout=function(a){Ajax.GET(Auth.URL+"/logout",a)};Auth.auth=function(a,b){if(a&&a.serialize)Ajax.POST(Auth.URL,a.serialize(),b)};Auth.register=Auth.auth;Auth.get=function(a){Ajax.GET(Auth.URL,a)};Auth.order={URL:"/auth/order"};Auth.order.all=function(a){Ajax.GET(Auth.order.URL,a)};Auth.order.find=function(a,b){Ajax.GET(Auth.order.URL+"/"+a,b)};Auth.order.getItem=function(a,b){Ajax.GET(Auth.order.URL+"/"+a+"/item",b)};Auth.payment={URL:"/auth/payment"};Auth.payment.all=function(a){Ajax.GET(Auth.payment.URL,a)};Auth.payment.find=function(a,b){Ajax.GET(Auth.payment.URL+"/"+a,b)};var Tumbon=Tumbon||{URL:"/tumbon"};Tumbon.find=function(a,b){Ajax.GET(Tumbon.URL+(isInteger(a)?"/"+a:a?"?q="+a:""),b)};var Amphur=Amphur||{URL:"/amphur"};Amphur.find=function(a,b){Ajax.GET(Amphur.URL+(isInteger(a)?"/"+a:a?"?q="+a:""),b)};var Province=Province||{URL:"/province"};Province.find=function(a,b){Ajax.GET(Province.URL+(isInteger(a)?"/"+a:a?"?q="+a:""),b)};var Shipment=Shipment||{};Shipment.Address=Shipment.Address||{URL:"/shipment/address"};Shipment.Address.find=function(a,b){Ajax.GET(Shipment.Address.URL+"/"+a,b)};Shipment.Address.all=function(a){Ajax.GET(Shipment.Address.URL,a)};Shipment.Address.add=function(a,b){if(a&&a.serialize)Ajax.POST(Shipment.Address.URL,a.serialize(),b)};Shipment.Address.update=function(a,b,c){if(b&&b.serialize)Ajax.POST(Shipment.Address.URL+"/"+a,b.serialize(),c)};Shipment.Method=Shipment.Method||{URL:"/shipment/method"};Shipment.Method.set=function(a,b){if(a&&a.serialize)Ajax.POST(Shipment.Method.URL,a.serialize(),b)};Shipment.Method.find=function(a,b){Ajax.GET(Shipment.Method.URL+"/"+a,b)};Shipment.Method.all=function(a){Ajax.GET(Shipment.Method.URL,a)};var Bank=Bank||{URL:"/bank"};Bank.all=function(a){Ajax.GET(Bank.URL,a)};Bank.find=function(a,b){Ajax.GET(Bank.URL+"/"+a,b)};var BankType=BankType||{URL:"/bankaccounttype"};BankType.all=function(a){Ajax.GET(BankType.URL,a)};BankType.find=function(a,b){Ajax.GET(BankType.URL+"/"+a,b)};var BankAccount=BankAccount||{URL:"/bankaccount"};BankAccount.all=function(a){Ajax.GET(BankAccount.URL,a)};BankAccount.find=function(a,b){if(isInteger(a))Ajax.GET(BankAccount.URL+"/"+a,b);else Ajax.GET(BankAccount.URL+"/q/"+a,b)};BankAccount.add=function(a,b){if(a&&a.serialize)Ajax.POST(BankAccount.URL,a.serialize(),b)};var Payment=Payment||{URL:"/payment"};Payment.confirm=function(a,b){if(a&&a.serialize)Ajax.POST(Payment.URL,a.serialize(),b)};Payment.approving=function(a,b){if(!b)Ajax.GET(Payment.URL+"/approving",a);else Ajax.GET(Payment.URL+"/approving?q="+b,a)};Payment.find=function(a,b){Ajax.GET(Payment.URL+"/"+a,b)};Payment.all=function(a,b){if(!b)Ajax.GET(Payment.URL,a);else Ajax.GET(Payment.URL+"?q="+b,a)};Payment.accept=function(a,b){Ajax.GET(Payment.URL+"/"+a+"/accept",b)};Payment.deny=function(a,b){Ajax.GET(Payment.URL+"/"+a+"/deny",b)};var Order=Order||{URL:"/order"};Order.find=function(a,b){Ajax.GET(Order.URL+"/"+a,b)};Order.items=function(a,b){Ajax.GET(Order.URL+"/"+a+"/item",b)};Order.all=function(a,b){if(!b)Ajax.GET(Order.URL,a);else Ajax.GET(Order.URL+"?q="+b,a)};Order.shipping=function(a,b){if(!b)Ajax.GET(Order.URL+"/shipping",a);else Ajax.GET(Order.URL+"/shipping?q="+b,a)};Order.shipped=function(a,b,c){Ajax.GET(Order.URL+"/"+a+"/shipped"+(b?"?track_id="+b:""),c)};Order.paid=function(a,b){if(!b)Ajax.GET(Order.URL+"/paid",a);else Ajax.GET(Order.URL+"/paid?q="+b,a)};