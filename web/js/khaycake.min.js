/* KhayCake by TheB1ackSheep, Front-End Developer 2015-05-09 */
var K;$(document).ready(function(){var a=$(".dialog");var b=$(".section-content");var c=c||{};c.url={};c.url.parse=urlParse;c.home=function(){$(b).html('<div class="cake">'+'<div class="cake-box">'+'<div class="cake-box-img">'+'<img src="images/khaycake-cupcake.png"/>'+"</div>"+'<div class="cake-box-name font-lily">Cupcake</div>'+'<div class="cake-box-detail secondary-text">คัพเค้กนมสด คุณภาพล้นถ้วย อร่อยไปกับเนื้อเค้กนมสด และวิปครีมไขมันต่ำหลากรสให้ท่านได้เลือกสรร พร้อมเป็นของขวัญสำหรับคนที่คุณรัก</div>'+'<div class="cake-box-buy"><a href="#!/cake/cupcake" class="btn btn-primary">BUY NOW</a></div>'+"</div>"+'<div class="cake-box">'+'<div class="cake-box-img">'+'<img src="images/khaycake-crabecake-white.png"/>'+"</div>"+'<div class="cake-box-name font-lily">Crapecake</div>'+'<div class="cake-box-detail secondary-text">สัมผัสกับความนุ่มละมุนของชั้นแป้งเนยสดสลับกับชั้นครีมหอมหวานละลานในปาก ราดด้วยสตอเบอร์รี่ไซรัปที่ตัดกับรสเค้กอย่างลงตัว</div>'+'<div class="cake-box-buy"><a href="#!/cake/crapecake" class="btn btn-primary">BUY NOW</a></div>'+"</div>"+'<div class="cake-box">'+'<div class="cake-box-img">'+'<img src="images/khaycake-logo-mask.png"/>'+"</div>"+'<div class="cake-box-name font-lily">Brownie</div>'+'<div class="cake-box-detail secondary-text">บราวนี่อุ่นๆจากเตา หอมกลุ่น กลมกล่อมไปกับรสช็อกโกแลตเข้มข้นที่โรยหน้าด้วยอัลมอนด์คัดสรรพิเศษ พร้อมเสิร์ฟให้คุณได้ลิ้มลองทุกวัน</div>'+'<div class="cake-box-buy"><a href="#!/cake/brownie" class="btn btn-primary">BUY NOW</a></div>'+"</div>"+'<div class="cake-box">'+'<div class="cake-box-img">'+'<img src="images/khaycake-logo-mask.png"/>'+"</div>"+'<div class="cake-box-name font-lily">Party Cake</div>'+'<div class="cake-box-detail secondary-text">ให้งานปาร์ตี้ของคุณหอมกรุ่นไปด้วยไอของขนมเค้กสุดพิเศษ ที่จะทำให้คุณและเพื่อน ๆ ในงานปาร์ตี้ของคุณไม่มีวันลืม ด้วยสีสันและรสชาติที่ไม่อาจลืม</div>'+'<div class="cake-box-buy"><a  href="#!/cake/partycake" class="btn btn-primary">BUY NOW</a></div>'+"</div>"+"</div>")};c.cake=function(){var a=Product.all;var d=c.url.parse();var e=d.params.page;var f=d.resources[2];if(!$("#cake-container").length>0){$(b).html(c.cake.container())}c.loadingMask("#cake-container");$("li").removeClass("active");$("li#"+f).addClass("active");var g=d.params.query;if(g)$("#form-search-cake").find("#keyword").val(g);else $("#form-search-cake").find("#keyword").val("");if(f=="cupcake")a=Product.cupcake;else if(f=="crapecake")a=Product.crapecake;else if(f=="brownie")a=Product.brownie;else if(f=="partycake")a=Product.partycake;else a=Product.all;a(function(a){var b="";if(a.message&&a.message.length>0){var d=pagination(a.message,e,8);for(var f in d.data){var g=d.data[f];b+=Product.box(g)}b+=d.html}else{b+='<div class="col-sm-12">ไม่มีสินค้าในระบบ</div>'}$("#cake-container").html(b);c.cake.bind()},g)};c.cake.container=function(){return'<div class="row">'+'<div class="col-sm-2">'+'<ul class="nav nav-pills nav-stacked">'+'<li role="presentation" id="all"><a href="#!/cake/all">ทั้งหมด</a></li>'+'<li role="presentation" id="cupcake"><a href="#!/cake/cupcake">คัพเค้ก</a></li>'+'<li role="presentation" id="crapecake"><a href="#!/cake/crapecake">เครปเค้ก</a></li>'+'<li role="presentation" id="brownie"><a href="#!/cake/brownie">บราวนี้</a></li>'+'<li role="presentation" id="partycake"><a href="#!/cake/partycake">ปาร์ตี้เค้ก</a></li>'+"</ul>"+"</div>"+'<div class="col-sm-10">'+'<form id="form-search-cake"><div class="input-group" style="margin-bottom: 18px;"><input type="text" name="q" id="keyword" class="form-control" placeholder="ค้นหาตามชื่อเค้ก, คำอธิบาย" required=""><span class="input-group-btn"><button class="btn btn-default" id="search-cake" type="submit">ค้นหา</button></span></div></form>'+'<div id="cake-container" class="row"></div>'+"</div>"+"</div>"};c.cake.bind=function(){var a=c.url.parse();var b=a.resources[2];$(".section-price .nav li").removeClass("active");$(".section-price .nav li"+"#"+b).addClass("active");$("#cake-container .cart-add").on("submit",function(a){a.preventDefault();var b=$(this).serializeArray()[0].value;Cart.add($(this),function(a){if(a.message){$("#cart-table").html(Cart.form(a.message));c.cart.bind()}});c.cart.add(b);return false});$("#form-search-cake").submit(function(){var a="/product";switch(b){case"cupcake":window.location.hash="#!/cake/cupcake?query="+$(this).find("#keyword").val();break;case"crapecake":window.location.hash="#!/cake/crapecake?query="+$(this).find("#keyword").val();break;case"brownie":window.location.hash="#!/cake/brownie?query="+$(this).find("#keyword").val();break;case"partycake":window.location.hash="#!/cake/partycake?query="+$(this).find("#keyword").val();break;default:window.location.hash="#!/cake/all?query="+$(this).find("#keyword").val();break}return false})};c.member=function(){var a=c.url.parse();var d=a.resources[2];c.loadingMask(b);Auth.get(function(a){if(a.message){var e=a.message;var f=e!=403;switch(d){case"login":if(f){window.location.hash="#!/member"}else{$(b).html(c.member.login.form())}break;case"register":$(b).html(c.member.register.form());break;default:if(f){c.member.show()}else{window.location.hash="#!/member/login"}break}}c.member.bind()})};c.member.show=function(){var a=c.url.parse();var d=a.resources[2];if(!$("#member-container").length>0)$(b).html(c.member.container());$("ul li").removeClass("active");switch(d){case"order":c.member.order();$("#user-order").addClass("active");break;case"payment":c.member.payment();$("#user-payment").addClass("active");break;case"logout":Auth.logout(function(a){if(a.message){window.location.hash="#!/member"}});break;default:c.member.main();$("#user-main").addClass("active");break}};c.member.main=function(){c.member.set('<a href="#!/member/logout" class="btn btn-danger">Logout</a>')};c.member.container=function(){return'<div class="row">'+'<div class="col-md-2">'+'<ul class="nav nav-pills nav-stacked">'+'<li role="presentation" id="user-main" class="active">'+'<a href="#!/member">ข้อมูลทั่วไป</a>'+"</li>"+'<li role="presentation" id="user-order">'+'<a href="#!/member/order">รายการสั่งซื้อ</a>'+"</li>"+'<li role="presentation" id="user-payment">'+'<a href="#!/member/payment">รายการแจ้งชำระเงิน</a>'+"</li>"+"</ul></div>"+'<div class="col-md-10" id="member-container"></div>'};c.member.bind=function(){$("#form-login").submit(c.member.login);$("#form-register").submit(c.member.register)};c.member.login=function(){c.loadingMask(b);var a={email:$(this).find("#email").val()};Auth.auth($(this),function(d){if(d.message&&d.message.email){window.location.hash="#!/member"}else{$(b).html(c.member.login.form(d.message,a));c.member.bind()}});return false};c.member.login.form=function(a,b){if(!b)b={};return'<form id="form-login">'+(a?'<div class="alert alert-warning" role="alert">'+a+"</div>":"")+'<div class="form-group">'+"<label>อีเมล์ :</label>"+'<input class="form-control" id="email" name="email" placholder="ninecake@khaycake.com" autocomplete="off" value="'+(b.email?b.email:"test@test.test")+'"/>'+"</div>"+'<div class="form-group">'+"<label>รหัสผ่าน :</label>"+'<input class="form-control" id="pwd" name="pwd" type="password" value="test"/>'+"</div>"+'<div class="form-group">'+'<button id="member-do-login" class="btn btn-primary">Login</button> <a href="#!/member/register">ฉันยังไม่มีรหัสผ่าน</a>'+"</div>"+"</form>"};c.member.register=function(){c.loadingMask(b);var a={email:$(this).find("#email").val()};Auth.register($(this),function(d){if(d.message&&d.message.email){window.location.hash="#!/member"}else{$(b).html(c.member.register.form(d.message,a));c.member.bind()}});return false};c.member.register.form=function(a,b){if(!b)b={};return'<form id="form-register">'+(a?'<div class="alert alert-warning" role="alert">'+a+"</div>":"")+'<div class="form-group">'+"<label>อีเมล์ :</label>"+'<input class="form-control" id="email" name="email" placholder="ninecake@khaycake.com" autocomplete="off" value="'+(b.email?b.email:"")+'"/>'+"</div>"+'<div class="form-group">'+"<label>รหัสผ่าน :</label>"+'<input class="form-control" id="pwd" name="pwd" type="password"/>'+"</div>"+'<div class="form-group">'+"<label>ยืนยันรหัสผ่าน :</label>"+'<input class="form-control" id="confirm-pwd" name="confirm-pwd" type="password"/>'+"</div>"+'<div class="form-group">'+'<button id="member-do-register" class="btn btn-primary">สมัครสมาชิก</button> <a href="#!/member/login">ฉันมีรหัสผ่านแล้ว</a>'+"</div>"+"</form>"};c.member.set=function(a){$("#member-container").html(a);c.member.bind()};c.member.order=function(){c.loadingMask("#member-container");var a=c.url.parse();var b=a.params.page;var d=a.resources[3];var e=a.resources[4];if(!d){Auth.order.all(function(a){if(a){var d=pagination(a.message,b,8);var e=c.member.order.table(d.data);if(d.hasNext)e+=d.html;c.member.set(e)}c.member.order.bind()})}else{if(!e||e&&e!="confirm"){Auth.order.getItem(d,function(a){if(a.message&&a.message.length>0){var b=a.message;var d=b[0].order;c.member.set(c.member.order.form(d,b))}else{c.member.set("ไม่พบรายการสั่งซื้อ")}c.member.order.bind()})}else{Auth.order.find(d,function(a){if(a.message){BankAccount.all(function(b){c.member.set(c.member.order.confirm.form(a.message));$("#bankaccount-container").html(c.member.bankaccount.form(b.message));c.member.order.bind()})}else c.member.set("ไม่พบรายการสั่งซื้อ")})}}};c.member.order.bind=function(){$("#form-order-payment").submit(c.member.order.confirm);$("#date").datepicker({autoclose:true,format:"dd/mm/yyyy"});$("#time").timepicker({showMeridian:false,showSeconds:false})};c.member.order.table=function(a){var b='<table class="table">';b+='<tr><th>เลขที่สั่งซื้อ</th><th>วันที่สั่งซื้อ</th><th>จำนวน (ชิ้น)</th><th>สถานะ</th><th class="text-right">ราคาทั้งหมด (บาท)</th></tr>';if(a&&a.length>0){for(var c in a){var d=a[c];var e="";if(d.status.id==1||d.status.id==2||d.status.id==5)e="rgb(226, 163, 0)";else if(d.status.id==3)e="green";else e="red";b+='<tr><td><a href="#!/member/order/'+d.id+'">#'+d.id+"</a></td><td>"+d.date+"</td>"+"<td>"+d.totalQty+'</td><td><span style="color:'+e+'">'+d.status.name+" "+(d.status.id==3&&d.trackId?"เลขติดตาม "+d.trackId:"")+'</span></td><td  class="text-right">'+toMoney(d.totalPrice)+"</td></tr>"}}else{b+='<tr><td colspan="5">ไม่มีรายการสั่งซื้อ</td></tr>'}b+="</table>";return b};c.member.order.form=function(a,b){var c=a.shipAddress;var d="";if(c){d+='<form class="order" id="form-order">'+"<h2>รายการสั่งซื้อ #"+a.id+"</h2><h3>ที่อยู่ในการจัดส่ง</h3>"+"<p>คุณ"+c.firstName+" "+c.lastName+"<br/>"+c.address+"<br/>"+c.tumbon.name+", "+c.tumbon.amphur.name+"<br/>"+c.tumbon.amphur.province.name+" "+c.tumbon.zipcode+"</p>"}d+="<h3>รายการสินค้า</h3>";d+='<form id="form-order"><table class="table"><tr><th>ชื่อ</th><th>จำนวน</th><th class="text-right">ราคา (บาท)</th></tr>';if(b.length>0){var e=b;var f=0;for(var g in e){var h=e[g];d+="<tr><td>"+h.product.name+"</td>"+"<td>"+h.qty+" "+h.product.unit.name+"</td>"+'<td class="text-right">'+toMoney(h.amount)+"</td></tr>";f+=h.amount}if(a.shipMethod){d+="<tr><td>ค่าจัดส่ง ("+a.shipMethod.name+")</td>"+"<td></td>"+'<td class="text-right">'+toMoney(a.shipMethod.price)+"</td></tr>";f+=a.shipMethod.price}d+='<tr><td colspan="2" class="text-right">รวม</td><td class="text-right" id="order-total">'+toMoney(f)+"</td></tr>"}else{d+='<tr><td colspan="3">ไม่มีสินค้าในตะกร้า</td></tr>'}d+="</table>";if(a.status.id==1||a.status.id==5)d+='<div class="text-right"><a class="btn btn-primary" href="#!/member/order/'+a.id+'/confirm">แจ้งชำระเงิน</a></div>';d+="</form>";d+="</form>";return d};c.member.order.confirm=function(){var a=$("#form-order-payment");c.loadingMask($("#member-container"));Payment.confirm(a,function(a){if(a.message.id){c.member.set(c.member.order.confirm.complete())}else{c.member.set(c.member.order.confirm.incomplete())}});return false};c.member.order.confirm.form=function(a){var b=new Date;var c='<form id="form-order-payment" class="form-horizontal">'+"<h3>แจ้งชำระเงิน รายการสั่งซื้อ #"+a.id+"</h3>"+'<input type="hidden" name="order_id" value="'+a.id+'">'+'<div class="form-group">'+'<label class="col-sm-2 control-label">เลขที่การสั่งซื้อ</label>'+'<div class="col-sm-10"><p class="form-control-static">'+a.id+"</p></div>"+"</div>"+'<div class="form-group">'+'<label class="col-sm-2 control-label">โอนเข้าบัญชี</label>'+'<div class="col-sm-10"><div id="bankaccount-container"></div></div>'+"</div>"+'<div class="form-group">'+'<label class="col-sm-2 control-label">วัน</label>'+'<div class="col-sm-10"><div class="input-group date"><input type="text" name="date" id="date" class="form-control" value="'+b.getDate()+"/"+b.getMonth()+"/"+b.getFullYear()+'"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span> </div></div>'+"</div>"+'<div class="form-group">'+'<label class="col-sm-2 control-label">เวลา (โดยประมาณ)</label>'+'<div class="col-sm-10"><div class="input-group time"><input type="text" name="time" id="time" class="form-control"><span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span> </div></div>'+"</div>"+'<div class="form-group">'+'<label class="col-sm-2 control-label">จำนวน (บาท)</label>'+'<div class="col-sm-10"><input name="amount" class="form-control" value="'+a.totalPrice.toFixed(2)+'"></div>'+"</div>";c+='<button class="btn btn-primary">ยืนยันการชำระเงิน</button>';c+="</form>";return c};c.member.order.confirm.complete=function(){return'<div class="checkout-complete"><h2>เย่! การสั่งซื้อเสร็จสมบูรณ์</h2><div class="checkout-complete-img"><img src="images/spongebob.jpg"></div>'+"<h3>เตรียมรอรับของได้เลย</h3></div>"};c.member.order.confirm.incomplete=function(){return'<div class="checkout-complete"><h2>โอ้วไม่! มีบางอย่างผิดพลาด</h2><div class="checkout-complete-img"><img src="images/sad.png"></div>'+"<h3>กรุณาลองใหม่อีกครั้งภายหลัง</h3></div>"};c.member.payment=function(){var a=c.url.parse();var b=a.params.page;c.loadingMask("#member-container");Auth.payment.all(function(a){var d=pagination(a.message,b,8);var e=c.member.payment.table(d.data);if(d.hasNext)e+=d.html;c.member.set(e)})};c.member.payment.table=function(a){var b='<table class="table">';b+='<tr><th>เลขที่สั่งซื้อ</th><th>วันที่แจ้ง</th><th>โอนเข้าบัญชี</th><th>สถานะ</th><th class="text-right">ยอดที่แจ้ง (บาท)</th></tr>';if(a&&a.length>0){for(var c in a){var d=a[c];var e="";if(d.status.id==1)e="rgb(226, 163, 0)";else if(d.status.id==2)e="green";else e="red";b+='<tr><td><a href="#!/member/order/'+d.order.id+'">'+d.order.id+'</a></td><td><span style="font-size:12px">'+d.dateTime+"</span></td>"+"<td>"+d.baac.accNo+" "+d.baac.branch.bank.name+"</td>"+'<td><span style="color:'+e+'">'+d.status.name+'</span></td><td class="text-right">'+toMoney(d.amount)+"</td></tr>"}}else{b+='<tr><td colspan="5">ไม่มีรายการแจ้งชำระเงิน</td></tr>'}b+="</table>";return b};c.member.bankaccount={};c.member.bankaccount.form=function(a){var b='<select class="form-control" name="bankacc_id">';for(var c in a){var d=a[c];b+='<option value="'+d.id+'">'+d.accNo+" "+d.branch.bank.name+"</option>"}b+="</select>";return b};c.cart=function(){Cart.all(function(a){if(a.message&&a.message.items&&a.message.items.length>0){$("#cart-table").html(Cart.form(a.message));c.cart.bind();if($(".cart-button").hasClass("inactive"))$(".cart-button").removeClass("inactive")}})};c.cart.open=function(){$(".cart-button").addClass("open");c.loadingMask($("#cart-table"));Cart.all(function(a){var b=a.message;if(!b)b={};$("#cart-table").html(Cart.form(b));c.cart.bind()})};c.cart.close=function(){$(".cart-button").removeClass("open")};c.cart.add=function(a,b){var c=$('<div id="clone"></div>');var d=$("#box-img-"+a)[0].getBoundingClientRect();if($(".cart-button").hasClass("inactive"))$(".cart-button").removeClass("inactive");var e=$(".cart-button .cart-open")[0].getBoundingClientRect();c.html($("#box-img-"+a).clone()).appendTo("body");c.css({top:d.top,left:d.left,width:d.width,height:d.height,opacity:1});c.animate({top:e.top-80,left:0,width:"53px",height:"53px"},500,function(){c.animate({top:e.top,height:"53px",opacity:0},300,function(){c.remove();if(typeof b==="function")b()})})};c.cart.bind=function(){$("#cart-table .column-remove span").click(function(){var a=$(this).parent().parent();$(a).animate({height:0},350,function(){$(a).remove();Cart.update($("#user-cart"),function(a){if(a.message){$("#cart-table").html(Cart.form(a.message));c.cart.bind()}})})})};c.checkout=function(){var a=c.url.parse();var d=a.resources[2];var e=c.checkout.header();$(b).html(e);$(".checkout-progressbar li").removeClass("active");for(var f=1;f<=5;f++)if(f<=d)$(".checkout-progressbar li:nth-child("+f+")").addClass("active");c.loadingMask($("#checkout-container"));Cart.all(function(a){Auth.get(function(b){var e=null;var f=null;var g=null;var h=a.message;var i=b.message;if(h){e=h.items;f=h.shipmentMethod;g=h.shipmentAddress}var j=null;if(i)j=i.email;if(d==1){c.checkout.set(c.checkout.cart.form(a.message))}else if(d==2&&e&&!j){c.checkout.set(c.checkout.login.form())}else if(d==2&&e&&j){window.location.hash="#!/checkout/3";return}else if(d==3&&e&&j){Shipment.Address.all(function(a){c.checkout.set(c.checkout.address.form(a.message))})}else if(d==4&&e&&j&&g){Shipment.Method.all(function(b){c.checkout.set(c.checkout.shipment.form(b.message,a.message.shipmentAddress))})}else if(d==5&&e&&j&&g&&f){c.checkout.set(c.checkout.order.form(a.message))}else if(d==6&&e&&j&&g&&f){c.checkout.complete()}else{window.location.hash="#!/checkout/1";return}})})};c.checkout.set=function(a){$("#checkout-container").html(a);c.loadedMask();c.checkout.bind()};c.checkout.bind=function(){$("#checkout-register").click(function(){c.checkout.set(c.checkout.register.form());return false});$("#checkout-login").click(function(){c.checkout.set(c.checkout.login.form());return false});$("#checkout-do-login").click(function(){c.checkout.login();return false});$("#checkout-do-register").click(function(){c.checkout.register();return false});$("#checkout-address").click(function(){c.checkout.address();return false});$("#form-address").find("#tumbons").autocomplete({serviceUrl:HOST+"/tumbon",paramName:"q",transformResult:function(a){if(JSON.parse(a).message)return{suggestions:$.map(JSON.parse(a).message,function(a){return{value:a.name+", "+a.amphur.name,data:a.id,display:a.name,label:a.amphur.name}})};return{suggestions:[]}},onSelect:function(a){var b=a.data;Tumbon.find(b,function(a){var c=a.message;$("#tumb_id").val(b);if(c){$("#amphur").val(c.amphur.name);$("#province").val(c.amphur.province.name);$("#zipcode").val(c.zipcode)}})}});$("#form-address").find("#amphur").autocomplete({serviceUrl:HOST+"/amphur",paramName:"q",transformResult:function(a){if(JSON.parse(a).message)return{suggestions:$.map(JSON.parse(a).message,function(a){return{value:a.name,data:a.id,label:a.province.name}})};return{suggestions:[]}},onSelect:function(a){var b=a.data;Amphur.find(b,function(a){var c=a.message;$("#amph_id").val(b);if(c){$("#province").val(c.province.name)}})}});$("#form-address").find("#province").autocomplete({serviceUrl:HOST+"/province",paramName:"q",transformResult:function(a){if(JSON.parse(a).message)return{suggestions:$.map(JSON.parse(a).message,function(a){return{value:a.name,data:a.id}})};return{suggestions:[]}},onSelect:function(a){var b=a.data;Province.find(b,function(a){var c=a.message;$("#prov_id").val(b);if(c){$("#province").val(c.province.name)}})}});$("#shipment-method").click(function(){Shipment.Method.set($("#form-shipment"),function(a){if(a.message){c.checkout.shipment.data=a.message.shipmentMethod;window.location.hash="#!/checkout/5"}});return false});$("#form-address").find("input[name=shad_id]").change(function(){if($(this).val()==-1)$("#new-address").attr("style","");else $("#new-address").attr("style","display:none")});$("#checkout-confirm").click(function(){c.loadingMask($("#checkout-container"));Cart.checkout(function(a){if(a.message)c.checkout.complete(a.message)});return false})};c.checkout.header=function(){return'<section class="checkout"><ul class="checkout-progressbar">'+'<li class="active">รายการสินค้า</li>'+'<li class="active">ยืนยันตัวตน</li>'+"<li>ที่อยู่ในการจัดส่ง</li>"+"<li>วิธีการจัดส่ง</li><li>ยืนยันการสั่งซื้อ</li>"+"</ul>"+'<div id="checkout-container"></div>'+"</section>"};c.checkout.login=function(){var a=$("#form-login");Auth.auth(a,function(a){if(a.message&&a.message.email){window.location.hash="#!/checkout/3"}})};c.checkout.login.form=function(){return'<form id="form-login">'+'<div class="form-group">'+"<label>อีเมล์ :</label>"+'<input class="form-control" id="email" name="email" placholder="ninecake@khaycake.com" autocomplete="off" value="test@test.test"/>'+"</div>"+'<div class="form-group">'+"<label>รหัสผ่าน :</label>"+'<input class="form-control" id="pwd" name="pwd" type="password" value="test"/>'+"</div>"+'<div class="form-group">'+'<button id="checkout-do-login" class="btn btn-primary">Login</button> <a id="checkout-register" href="#!/checkout">ฉันยังไม่มีรหัสผ่าน</a>'+"</div>"+"</form>"};c.checkout.register=function(){var a=$("#form-register");Auth.register(a,function(a){if(a.message&&a.message.email){window.location.hash="#!/checkout/3"}})};c.checkout.register.form=function(){return'<form id="form-register">'+'<div class="form-group">'+"<label>อีเมล์ :</label>"+'<input class="form-control" id="email" name="email" placholder="ninecake@khaycake.com" autocomplete="off"/>'+"</div>"+'<div class="form-group">'+"<label>รหัสผ่าน :</label>"+'<input class="form-control" id="pwd" name="pwd" type="password"/>'+"</div>"+'<div class="form-group">'+"<label>ยืนยันรหัสผ่าน :</label>"+'<input class="form-control" id="confirm-pwd" name="confirm-pwd" type="password"/>'+"</div>"+'<div class="form-group">'+'<button id="checkout-do-register" class="btn btn-primary">Register</button> <a id="checkout-login" href="#!/checkout">ฉันมีรหัสผ่านแล้ว</a>'+"</div>"+"</form>"};c.checkout.address=function(){var a=$("#form-address");Shipment.Address.add(a,function(a){if(a.message){window.location.hash="#!/checkout/4"}})};c.checkout.address.form=function(a){var b='<form id="form-address"><h3 class="title">ที่อยู่ในของคุณ</h3>';b+="<table>";for(var c in a){var d=a[c];b+='<tr><td><input type="radio" name="shad_id" style="float:left" value="'+d.id+'"/></td><td>คุณ'+d.firstName+" "+d.lastName+" "+d.address+" "+d.tumbon.name+", "+d.tumbon.amphur.name+" "+d.tumbon.amphur.province.name+" "+d.tumbon.zipcode+"</td></tr>"}b+='<tr><td><input type="radio" name="shad_id" id="new-address-radio" value="-1"/></td><td> เพิ่มที่อยู่ใหม่</td></tr>'+"<tr><td></td>"+'<td><div id="new-address" style="display:none"><div class="col-sm-6">'+'<div class="form-group">'+'<label>ชื่อจริง</label><input type="text" name="fname" id="fname" class="form-control" autocomplete="off"/>'+"</div>"+"</div>"+'<div class="col-sm-6">'+'<div class="form-group">'+'<label>นามสกุล</label><input type="text" name="lname" id="lname" class="form-control" autocomplete="off"/>'+"</div>"+"</div>"+'<div class="col-md-12">'+'<div class="form-group">'+"<label>ที่อยู่</label>"+'<textarea name="address" id="addr" cols="30" rows="8" class="form-control" placeholder="123 ซอย 13 หมู่บ้านขายเค้ก ถนนเค้กนุ่ม">'+"</textarea>"+"</div>"+"</div>"+'<div class="col-md-6">'+'<div class="form-group">'+'<label>ตำบล/แขวง</label><input list="tumbon-list" type="text" class="form-control" name="tumbons" id="tumbons"/>'+'<input type="hidden" name="tumb_id" id="tumb_id" value=""/>'+"</div>"+"</div>"+'<div class="col-md-6">'+'<div class="form-group">'+'<label>อำเภอ/เขต</label><input list="amphur-list" type="text" class="form-control" name="amphur" id="amphur"/>'+'<input type="hidden" name="amph_id" id="amph_id" value=""/>'+"</div>"+"</div>"+'<div class="col-md-6">'+'<div class="form-group">'+'<label>จังหวัด</label><input type="text" list="province-list" class="form-control" name="province" id="province"/>'+'<input type="hidden" name="prov_id" id="prov_id" value=""/>'+"</div>"+"</div>"+'<div class="col-md-6">'+'<div class="form-group">'+'<label>รหัสไปรษณีย์</label><input type="text" list="zipcode-list" class="form-control" name="zipcode" id="zipcode"/>'+'<datalist id="zipcode-list"></datalist>'+"</div>"+"</div></td></tr></table>"+'<div class="text-right"><button id="checkout-address" class="btn btn-primary">ถัดไป</button></div>'+"</form>";return b};c.checkout.shipment=function(){};c.checkout.shipment.form=function(a,b){var c='<form id="form-shipment"><h3>วิธีการจัดส่ง</h3><table class="table"><tr><th>วิธีจัดส่ง</th><th>ค่าขนส่ง (บาท)</th></tr>';for(var d in a){var e=a[d];if(e.id<=4&&b.tumbon.amphur.province.id==1||e.id<=3&&b.tumbon.amphur.province.id>1)c+='<tr><td><input type="radio" name="shme_id" value="'+e.id+'"/> '+e.name+"</td><td>"+e.price+"</td></tr>"}c+='</table><div class="text-right"><button id="shipment-method" class="btn btn-primary">ถัดไป</button></div></form>';return c};c.checkout.cart={};c.checkout.cart.form=function(a){var b='<form id="form-cart"><table class="table"><tr><th>ชื่อ</th><th>จำนวน</th><th class="text-right">ราคา (บาท)</th></tr>';var c=false;if(a&&a.items&&a.items.length>0){c=true;var d=a.items;var e=0;for(var f in d){var g=d[f];b+="<tr><td>"+g.product.name+"</td>"+"<td>"+g.qty+" "+g.product.unit.name+"</td>"+'<td class="text-right">'+toMoney(g.total)+"</td></tr>";e+=g.total}if(a.shipmentMethod){b+="<tr><td>ค่าจัดส่ง ("+a.shipmentMethod.name+")</td>"+"<td></td>"+'<td class="text-right">'+toMoney(a.shipmentMethod.price)+"</td></tr>";e+=a.shipmentMethod.price}b+='<tr><td colspan="2" class="text-right">รวม</td><td class="text-right" id="order-total">'+toMoney(e)+"</td></tr>"}else{b+='<tr><td colspan="3">ไม่มีสินค้าในตะกร้า</td></tr>'}b+="</table>";if(c)b+='<div class="text-right"><a class="btn btn-primary" id="checkout-next" href="#!/checkout/2">ถัดไป</a></div>';b+="</form>";return b};c.checkout.order=function(){};c.checkout.order.form=function(a){var b=a.shipmentAddress;var c="";if(b){c+='<form class="order" id="form-order">'+"<h3>ที่อยู่ในการจัดส่ง</h3>"+'<input type="hidden" name="addr_id" value="'+b.id+'"/>'+"<p>คุณ"+b.firstName+" "+b.lastName+"<br/>"+b.address+"<br/>"+b.tumbon.name+", "+b.tumbon.amphur.name+"<br/>"+b.tumbon.amphur.province.name+" "+b.tumbon.zipcode+"</p>"}c+="<h3>รายการสินค้า</h3>";c+='<form id="form-cart"><table class="table"><tr><th>ชื่อ</th><th>จำนวน</th><th class="text-right">ราคา (บาท)</th></tr>';if(a&&a.items&&a.items.length>0){var d=a.items;var e=0;for(var f in d){var g=d[f];c+="<tr><td>"+g.product.name+"</td>"+"<td>"+g.qty+" "+g.product.unit.name+"</td>"+'<td class="text-right">'+toMoney(g.total)+"</td></tr>";e+=g.total}if(a.shipmentMethod){c+="<tr><td>ค่าจัดส่ง ("+a.shipmentMethod.name+")</td>"+"<td></td>"+'<td class="text-right">'+toMoney(a.shipmentMethod.price)+"</td></tr>";e+=a.shipmentMethod.price}c+='<tr><td colspan="2" class="text-right">รวม</td><td class="text-right" id="order-total">'+toMoney(e)+"</td></tr>"}else{c+='<tr><td colspan="3">ไม่มีสินค้าในตะกร้า</td></tr>'}c+="</table>";c+='<div class="text-right"><button class="btn btn-primary" id="checkout-confirm">ยืนยันการสั่งซื้อ</button></div>';c+="</form>";c+="</form>";return c};c.checkout.complete=function(a){var b='<div class="checkout-complete"><h2>เย่! การสั่งซื้อเสร็จสมบูรณ์</h2><div class="checkout-complete-img"><img src="images/spongebob.jpg"></div>'+'<h3>กรุณาชำระเงินตามรายละเอียดด้านล่าง</h3><p>ท่านสามารถชำระเงินได้ โดยการโอนเงินเข้าบัญชีของทางร้านตามเลขบัญชีด้านล่าง หลังจากนั้น ท่านสามารถแจ้งชำระเงินได้ ในหน้า <a href="#!/member/order/'+a.id+'">สมาชิก</a> ครับ</p></div>';b+='<div class="flex flex-center">';BankAccount.all(function(a){if(a.message){for(var d in a.message){var e=a.message[d];b+=c.bankaccount.box(e)}}b+="</div>";c.checkout.set(b)})};c.bankaccount={};c.bankaccount.box=function(a){return'<div class="bank-acc">'+'<div class="bank-acc-img"><img src="images/bank/'+a.branch.bank.slug+'.png"></div>'+'<div class="bank-acc-text"><div class="title">สาขา</div>'+a.branch.name+"</div>"+'<div class="bank-acc-text"><div class="title">ชื่อบัญชี</div>'+a.accName+"</div>"+'<div class="bank-acc-text"><div class="title">เลขบัญชี</div>'+a.accNo+"</div>"+'<div class="bank-acc-text"><div class="title">ประเภท</div>'+a.type.name+"</div>"+"</div>"};c.onHashChanged=function(){var a=c.url.parse();var b=a.resources[1];if(!isCookieEnable()){var d=getParameter("session");if(d)sessionID=d;if(sessionID)window.location.hash=urlParam("session",sessionID)}c.cart.close();switch(b){case"cake":c.cake();break;case"checkout":c.checkout();break;case"member":c.member();break;default:c.home();break}};c.loadingMask=function(a){$(a).css({minHeight:$(a).height()});$(a).html("<div class='col-sm-12' style='text-align: center;overflow: hidden'><span class='loader'><span class='loader-inner'></span></span></div>")};c.loadedMask=function(a){$(a).html("")};$(window).bind("hashchange",function(){c.onHashChanged()});$(".cart-button .cart-open").click(function(){c.cart.open()});$(".order-item .cart-close").click(function(){c.cart.close()});c.onHashChanged();c.cart()});