/* KhayCake by TheB1ackSheep, Front-End Developer 2015-05-03 */
var K;$(document).ready(function(){var a=$(".dialog");var b=$(".dialog-content");var c=$(".section-price");var d=d||{params:[],getParam:function(a){return this.params[a]},setParam:function(a,b){this.params[a]=b},isInteger:function(a){return a?a.toString().match(/^[0-9]+$/)!==null:false},isFloat:function(a){return a?(this.isInteger(a.toString())||a.toString().match(/^\.[0-9]+$/)||a.toString().match(/^[0-9]+\.[0-9]+$/))!==null:false}};d.onHashChanged=function(){var a=window.location.hash.substr(2);var b=a.split("/")[1];switch(b){case"shop":g.open();break;case"login":h.open();break;default:g.close();break}};var e=e||{PARAM_BEGIN_POS:"begin-pos",getDialog:function(){return $(".dialog")},getBeginPos:function(){return d.getParam(this.PARAM_BEGIN_POS)}};e.isOpen=function(){return c.hasClass("open")};e.open=function(d){if(!this.isOpen()){c.addClass("open");var e=this.getBeginPos();if(e){var f=e.getBoundingClientRect();var g=e.parentNode.parentNode.parentNode.getBoundingClientRect();a.css({top:f.top-g.top+"px",left:f.left-g.left+"px",backgroundColor:"#3E2733"})}else{a.css({top:"50%",left:"50%",backgroundColor:"#3E2733"})}b.css({opacity:0});a.animate({width:"100%",height:"100%",top:0,left:0,backgroundColor:"#fff"},200,function(){b.animate({opacity:1});if(typeof d==="function")d()})}};e.setContent=function(a){b.html(a)};e.close=function(d){if(this.isOpen()){c.removeClass("open");var e=this.getBeginPos();var f;if(e){var g=e.getBoundingClientRect();var h=e.parentNode.parentNode.parentNode.getBoundingClientRect();f={width:g.width,height:g.height,top:g.top-h.top+"px",left:g.left-h.left+"px",backgroundColor:"#3E2733"}}else{f={width:0,height:0,top:"50%",left:"50%",backgroundColor:"#fff"}}b.animate({opacity:0},100,function(){a.animate({width:f.width,height:f.height,top:f.top,left:f.left,backgroundColor:f.backgroundColor},350,function(){a.attr("style","");if(typeof d==="function")d()})})}};var f=f||{ID_CART:".cart-button",ID_CART_ICON:".cart-button .cart-open",ID_CART_CLOSE:".order-item .cart-close",total:0,isOpen:function(){return $(this.ID_CART).hasClass("open")},open:function(){$(this.ID_CART).addClass("open")},close:function(){$(this.ID_CART).removeClass("open")},addItem:function(a){if($(a).hasClass("box")){console.log(this.ID_CART_ICON);var b=$('<div id="clone"></div>');var c=$(a)[0].getBoundingClientRect();var d=false;if($(this.ID_CART).hasClass("inactive")){$(this.ID_CART).removeClass("inactive");d=true}setTimeout(function(){var d=$(f.ID_CART_ICON)[0].getBoundingClientRect();b.html($(a).find(".box-img").clone()).appendTo("body");b.css({top:c.top,left:c.left,width:c.width,opacity:1});b.animate({top:d.top-60,left:0,width:"53px"},500,function(){b.animate({top:d.top,opacity:0},300,function(){b.remove()})})},d?0:0)}}};var g=g||{CN_NAV:".dialog .nav",CN_NAV_LIST:".dialog .nav li",ID_CAKE_CONTAINER:"#cake-container",getContainer:function(a){var b="";for(var c in a){b+=this.getCakeBox(a[c])}return'<div class="row">'+'<div class="col-md-2">'+'<ul class="nav nav-pills nav-stacked">'+'<li role="presentation" id="cupcake"><a href="#!/shop/cupcake">Cupcake</a></li>'+'<li role="presentation" id="crapecake"><a href="#!/shop/crapecake">Crape Cake</a></li>'+'<li role="presentation" id="brownie"><a href="#!/shop/brownie">Brownie</a></li>'+'<li role="presentation" id="partycake"><a href="#!/shop/partycake">Party Cake</a></li>'+"</ul>"+"</div>"+'<div class="col-md-10">'+'<div id="cake-container" class="row">'+b+"</div>"+"</div>"+"</div>"},getCakeBox:function(a){return'<div class="col-md-3 col-sm-4 col-xs-6">'+'<div class="box inactive">'+'<div class="box-img">'+'<img src="'+HOST+"/product/"+a.id+'/picture" alt=""/>'+"</div>"+'<div class="box-name">'+a.name+"</div>"+'<div class="box-button">'+'<div class="price">'+a.price+" บาท/"+a.unit.name+"</div>"+'<button class="cart">Add to Cart</button>'+"</div>"+"</div>"+"</div>"}};g.open=function(){var a=window.location.hash.substr(2);var b=a.split("/");var c=null;if(b.length>=3)c=b[2];var d=null;switch(c){case"cupcake":Product.cupcake(function(a){if(a.success){if(a.message&&a.message.length>0){e.open();e.setContent(g.getContainer(a.message));g.tab()}else{}}else{}});break;case"crapecake":Product.crapecake(function(a){if(a.success){if(a.message&&a.message.length>0){e.open();e.setContent(g.getContainer(a.message));g.tab()}else{}}else{}});break;case"brownie":Product.brownie(function(a){if(a.success){if(a.message&&a.message.length>0){e.open();e.setContent(g.getContainer(a.message));g.tab()}else{}}else{}});break;case"partycake":Product.partycake(function(a){if(a.success){if(a.message&&a.message.length>0){e.open();e.setContent(g.getContainer(a.message));g.tab()}else{}}else{}});break;default:Product.all(function(a){if(a.success){if(a.message&&a.message.length>0){e.open();e.setContent(g.getContainer(a.message));g.tab()}else{}}else{}});break}};g.close=function(){e.close()};g.tab=function(){var a=window.location.hash.substr(2);var b=a.split("/");var c=null;if(b.length>=3)c=b[2];$(g.CN_NAV_LIST).removeClass("active");$(g.CN_NAV_LIST+"#"+c).addClass("active")};var h=h||{ID_FORM_NAME:"form-login",getForm:function(){return'<form id="'+this.ID_FORM_NAME+'">'+'<div class="form-group">'+"<label>Username :</label>"+'<input class="form-control" id="email" placholder="ninecake@khaycake.com"/>'+"</div>"+'<div class="form-group">'+"<label>Password :</label>"+'<input class="form-control" id="pwd" type="password"/>'+"</div>"+'<div class="form-group">'+'<button class="btn btn-primary">Login</button>'+"</div>"+"</form>"}};h.open=function(){e.open(h.getForm())};$(window).bind("hashchange",function(){d.onHashChanged()});if(window.location.hash){d.onHashChanged()}$(".cake-box-buy a").click(function(a){d.setParam(e.PARAM_BEGIN_POS,this)});$(f.ID_CART_ICON).click(function(){f.open()});$(f.ID_CART_CLOSE).click(function(){f.close()});K=d});